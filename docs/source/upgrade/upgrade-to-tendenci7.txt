Upgrading from 6.0.x
====================

Step 1: Back up your site and database
--------------------------------------

If you're using docker, just backup your docker container:
::

docker commit <site_name> backup/<site_name>:<your tag>


Step 2: Update some files
-------------------------

These 4 files need to be updated:

  - requirements/common.txt
  - conf/settings.py
  - conf/local_settings.py
  - deploy.py

**requirements/common.txt**:

Replace with the content of https://github.com/tendenci/tendenci-project-template/blob/master/requirements/common.txt

**conf/settings.py**:

Replace:
::

    TEMPLATE_DIRS += (os.path.join(PROJECT_ROOT, "themes"),)

With:
::

    TEMPLATES[0]['DIRS'] += (os.path.join(PROJECT_ROOT, "themes"),)

Replace:
::

    TEMPLATE_CONTEXT_PROCESSORS += (
        'django.core.context_processors.static',
        'tendenci.apps.base.context_processors.newrelic',)
    
With:
::

    TEMPLATES[0]['OPTIONS']['context_processors'] += (
        'django.core.context_processors.static',
        'tendenci.apps.base.context_processors.newrelic',)
 
Also, check your addons to make sure they are T7 compatible. If they are not, comment out these two lines.
::

    from tendenci.apps.registry.utils import update_addons
    INSTALLED_APPS = update_addons(INSTALLED_APPS, SITE_ADDONS_PATH)
    

**conf/local_settings.py**:

Replace:
::

    'OPTIONS': {'autocommit': True},
With:
::

    'autocommit': True,

Remove: 
::

    TEMPLATE_CONTEXT_PROCESSORS = get_setting('TEMPLATE_CONTEXT_PROCESSORS')

Remove:
::

    SOUTH_MIGRATION_MODULES = { 'explorer': 'explorer.south_migrations', }

**deploy.py**

Replace with the content of https://github.com/tendenci/tendenci-project-template/blob/master/deploy.py



Step 3: Remove south from environment
-------------------------------------
::

    pip uninstall South


.. Note:: 

    For some reason, we were not able to make a clean install in docker containers. We ended up rebuilding the dist-packages.
    ::

        rm -rf /usr/local/lib/python2.7/dist-packages
        mkdir /usr/local/lib/python2.7/dist-packages
        chmod g+w /usr/local/lib/python2.7/dist-packages
        curl https://bootstrap.pypa.io/get-pip.py | sudo python


Step 4: Install requirements
----------------------------
::

    pip install -r requirements.txt --upgrade


Step 5: Fake initials
---------------------
::

    python manage.py fake_initials


Step 6: Run deploy
------------------
::

    python manage.py migrate
    python deploy.py


If everything goes well, restart your site.
